<html>
<head>
  <title>hi</title>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'/>
</head>
<body>
  <div class="container">
    <div class="starter-template">
      <div id="app">
          Logged into Lawson machines:
          <ul>
            <li v-for="(machines, user) in users">
              {{ user }} 
              <ul>
                <li v-for="machine in machines">
                {{ machine.hostname }}
                <b v-if="!machine.device.startsWith('tty')">SSH</b>
                </li>
              </ul>
            </li>
          </ul>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script>
    var url = "http://data.cs.purdue.edu:57888/api/master";
    var app = new Vue({
      el: '#app',

      data: {
        response: null,
        users: null
      },

      created: function() {
        this.fetchData();
      },

      methods: {
        fetchData: function () {
          var self = this;
          $.getJSON( url, function( data ) {
            self.response = data;
            map = {};
            for (var cluster in data['response']) {
              for (var host in data['response'][cluster]) {
                var hostData = data['response'][cluster][host];
                for (var user in hostData['users']) {
                  var careerAcc = hostData['users'][user]['careerAcc'];
                  var e = {
                      'hostname': hostData['hostname'],
                      'device': hostData['users'][user]['device'],
                  };
                  
                  if (careerAcc in map)
                    map[careerAcc].push(e);
                  else
                    map[careerAcc] = [e];
                }
              }
            }
            self.users = map;
          });
        }
      }
    });
    app.fetchData();
  </script>
</body>
</html>
